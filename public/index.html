<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no"/>
  <meta name="theme-color" content="#0b1220"/>
  <title>ATHENS NAV • CPYA</title>

  <link rel="stylesheet" href="styles.css">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <!-- Leaflet Routing Machine -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>
</head>

<body>
<div class="app">
  <div id="map" aria-label="Map"></div>

  <!-- Custom zoom -->
  <div class="zoomBarWrap" aria-hidden="false">
    <div class="zoomBar" role="group" aria-label="Zoom controls">
      <div class="zoomBtn" id="zoomOut" title="Zoom out" aria-label="Zoom out">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M6 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="zoomBtn" id="zoomIn" title="Zoom in" aria-label="Zoom in">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 6v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M6 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- Top bar -->
  <header class="appbar">
    <button class="iconbtn" id="btnMenu" aria-label="Open menu" title="Menu">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <div class="brand">
      <div class="t1">ATHENS NAV</div>
      <div class="t2">CPYA • v1.3</div>
    </div>

    <div class="searchWrap" role="search">
      <div class="search">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" style="width:18px;height:18px;opacity:.85;">
          <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/>
          <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input id="q" autocomplete="off" inputmode="search" placeholder="Search in Athens (e.g., Acropolis, Syntagma, Lidl)…"/>
      </div>

      <!-- Suggestions -->
      <div class="suggest" id="suggest">
        <div class="suggestList" id="suggestList"></div>
      </div>
    </div>

    <button class="iconbtn" id="btnGo" aria-label="Search" title="Search">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M5 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M13 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div class="pill" title="Athens-only mode">
      <span class="dot"></span> Athens
    </div>
  </header>

  <!-- Widgets -->
  <div class="widgets">
    <div class="widget wSmall" aria-label="Time">
      <div class="widgetRow">
        <div>
          <div class="widgetTitle">Time</div>
          <div class="widgetValue" id="timeVal">--:--</div>
        </div>
        <div style="font-size:12px;color:rgba(234,240,255,.7);" id="dateVal">---</div>
      </div>
    </div>

    <div class="widget wSmall" aria-label="Weather">
      <div class="widgetRow">
        <div>
          <div class="widgetTitle">Weather</div>
          <div class="widgetValue" id="weatherVal">--</div>
        </div>
        <div class="weatherIcon" id="weatherIcon" title="Weather icon" aria-hidden="true"></div>
      </div>
      <div style="margin-top:6px;font-size:12px;color:rgba(234,240,255,.70);" id="weatherSub">Athens</div>
    </div>

    <div class="widget compassWrap" aria-label="Compass">
      <div class="compassBox">
        <div class="compass" title="Compass">
          <div class="n">N</div>
          <div class="needle" id="needle"></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <div style="font-size:12px;color:rgba(234,240,255,.70);" id="headingTxt">--°</div>
          <button class="miniBtn primary" id="btnCompass">Enable</button>
        </div>
      </div>
    </div>
  </div>

  <!-- HOME: Routing quick controls (NOT in settings) -->
  <div class="sheet" aria-hidden="false">
    <section class="panel show" id="panel" aria-label="Panel">
      <div class="panelHeader">
        <div class="title">
          <strong id="panelTitle">Ready</strong>
          <small id="panelSubtitle">Locating you… then tap map to pin or search.</small>
        </div>
        <button class="iconbtn" id="btnClosePanel" aria-label="Close panel" title="Close">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <!-- HOME quick routing strip -->
      <div style="padding:10px 10px 0 10px;">
        <div class="card" style="margin-bottom:10px;">
          <div class="row">
            <div style="min-width:0;">
              <div class="name">Routing</div>
              <div class="addr">Mode and toggles are always on the home screen.</div>
            </div>
            <span class="chip primary" id="btnHomeRouteInfo">Tip</span>
          </div>

          <div class="row" style="margin-top:10px;">
            <div style="font-size:12px;color:rgba(234,240,255,.70);">
              Mode: <b id="modeBadgeHome">Driving</b>
            </div>
          </div>

          <div class="seg" role="group" aria-label="Routing mode" style="margin-top:10px;">
            <button id="segDrive" class="active">Driving</button>
            <button id="segWalk">Walking</button>
            <button id="segBike">Cycling</button>
          </div>

          <div class="row" style="margin-top:10px;">
            <div class="toggleRow" style="flex:1;">
              <label style="font-size:13px;">Auto-fit</label>
              <div class="switch on" id="swFitHome" role="switch" aria-checked="true" tabindex="0"></div>
            </div>

            <div class="toggleRow" style="flex:1;">
              <label style="font-size:13px;">Steps</label>
              <div class="switch on" id="swStepsHome" role="switch" aria-checked="true" tabindex="0"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="panelBody">
        <div class="list" id="panelList"></div>
      </div>
    </section>
  </div>

  <!-- Near Me bottom sheet (starts fully CLOSED; app.js sets --nearY off-screen) -->
  <div class="nearSheet" aria-hidden="false">
    <section class="nearPanel" id="nearPanel" aria-label="Near me">
      <div class="nearHead" id="nearHandle">
        <div class="grab"></div>
        <div class="nearTopRow">
          <div class="nearTitle">
            <strong>Near Me</strong>
            <small id="nearSub">Closed</small>
          </div>
          <button class="iconbtn" id="nearClose" aria-label="Close near me" title="Close">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="nearBody">
        <div class="nearControls">
          <select class="select" id="nearType" aria-label="Category">
            <option value="pharmacy">Pharmacies</option>
            <option value="atm">ATMs</option>
            <option value="supermarket">Supermarkets</option>
            <option value="cafe">Cafes</option>
            <option value="restaurant">Restaurants</option>
            <option value="fuel">Gas stations</option>
            <option value="hospital">Hospitals</option>
            <option value="police">Police</option>
            <option value="parking">Parking</option>
          </select>

          <select class="select" id="nearRadius" aria-label="Radius">
            <option value="400">400 m</option>
            <option value="800" selected>800 m</option>
            <option value="1500">1.5 km</option>
            <option value="2500">2.5 km</option>
          </select>

          <button class="miniBtn primary" id="nearGo">Scan</button>
        </div>

        <div class="hint">Uses your location. Tap a result → destination pin → Route.</div>
        <div class="list" id="nearList"></div>
      </div>
    </section>
  </div>

  <!-- Bottom Dock -->
  <nav class="dock" role="navigation" aria-label="Bottom actions">
    <button class="dockbtn active" id="dockSearch" aria-label="Search">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/>
        <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Search</span>
    </button>

    <button class="dockbtn" id="dockRoute" aria-label="Route">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M7 17c2.5 0 2.5-6 5-6s2.5 6 5 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M7 17a2 2 0 1 0 0.001 0Z" stroke="currentColor" stroke-width="2"/>
        <path d="M17 17a2 2 0 1 0 0.001 0Z" stroke="currentColor" stroke-width="2"/>
        <path d="M12 11a2 2 0 1 0 0.001 0Z" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span>Route</span>
    </button>

    <button class="dockbtn" id="dockNear" aria-label="Near me">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M12 2v2M12 20v2M2 12h2M20 12h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="currentColor" stroke-width="2"/>
        <path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span>Near</span>
    </button>

    <button class="dockbtn" id="dockLocate" aria-label="Locate">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M12 2v3M12 19v3M2 12h3M19 12h3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span>Locate</span>
    </button>

    <button class="dockbtn" id="dockClear" aria-label="Clear">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M7 7h10M9 7V5h6v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M8 7l1 14h6l1-14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Clear</span>
    </button>
  </nav>

  <!-- Drawer -->
  <div class="overlay" id="overlay"></div>
  <aside class="drawer" id="drawer" aria-label="Menu">
    <div class="drawerHeader">
      <div class="meta">
        <strong>Settings</strong>
        <span id="settingsSub">Athens-only • search provider • account</span>
      </div>
      <button class="iconbtn" id="btnCloseDrawer" aria-label="Close menu" title="Close">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <!-- MUST remain scrollable -->
    <div class="drawerBody">
      <!-- Account section -->
      <div class="section">
        <div class="secHead">
          <strong>Account</strong>
          <span style="font-size:12px;color:rgba(234,240,255,.65);" id="acctStatus">Guest</span>
        </div>
        <div class="secBody">
          <button class="btn primary" id="btnOpenAuth">Log in / Create account</button>
          <button class="btn danger" id="btnLogout" style="display:none;">Log out</button>
          <div class="hint">Placeholder only for now (stored locally). You’ll design real graphics later.</div>
        </div>
      </div>

      <div class="section">
        <div class="secHead"><strong>Search provider</strong><span style="font-size:12px;color:rgba(234,240,255,.65);">CPYA → OSM</span></div>
        <div class="secBody">
          <div class="toggleRow">
            <label>Prefer CPYA backend</label>
            <div class="switch on" id="swCPYA" role="switch" aria-checked="true" tabindex="0"></div>
          </div>
          <input class="select" id="cpyaEndpoint" placeholder="Optional endpoint e.g. /api/where" />
          <div class="hint">If empty: tries /api/where → /where → /search. Falls back to Nominatim.</div>
        </div>
      </div>

      <div class="section">
        <div class="secHead"><strong>Athens lock</strong><span style="font-size:12px;color:rgba(234,240,255,.65);">Bounds</span></div>
        <div class="secBody">
          <div class="toggleRow">
            <label>Strict Athens-only</label>
            <div class="switch on" id="swLock" role="switch" aria-checked="true" tabindex="0"></div>
          </div>
          <div class="hint">Prevents panning/zooming outside Athens area.</div>
          <button class="btn" id="btnRecenter">Recenter Athens</button>
        </div>
      </div>

      <div class="section">
        <div class="secHead"><strong>Location</strong><span style="font-size:12px;color:rgba(234,240,255,.65);">Persist</span></div>
        <div class="secBody">
          <div class="toggleRow">
            <label>Remember my location</label>
            <div class="switch on" id="swRememberLoc" role="switch" aria-checked="true" tabindex="0"></div>
          </div>
          <button class="btn" id="btnAskLoc">Request location now</button>
          <div class="hint">When enabled, your last known location is restored after reload.</div>
        </div>
      </div>

      <div class="section">
        <div class="secHead"><strong>Maintenance</strong><span style="font-size:12px;color:rgba(234,240,255,.65);">Reset</span></div>
        <div class="secBody">
          <button class="btn danger" id="btnHardReset">Clear everything</button>
        </div>
      </div>
    </div>

    <div class="drawerFooter">
      Map actions: <b>Tap</b> to drop destination pin. Use <b>Near Me</b> only when you press Near. Routing controls stay on home.
    </div>
  </aside>

  <!-- Auth Modal (local placeholder UI) -->
  <div id="authOverlay" style="display:none;position:absolute;inset:0;z-index:140;background:rgba(0,0,0,.45);backdrop-filter:blur(3px);"></div>
  <div id="authModal" style="display:none;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:145;width:min(520px,92vw);border-radius:22px;border:1px solid rgba(255,255,255,.10);background:rgba(14,23,48,.94);box-shadow:0 18px 60px rgba(0,0,0,.45);overflow:hidden;">
    <div style="padding:12px 12px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;align-items:center;justify-content:space-between;gap:10px;">
      <div style="display:flex;flex-direction:column;gap:2px;min-width:0;">
        <strong style="font-size:14px;">Account</strong>
        <span id="authSub" style="font-size:12px;color:rgba(234,240,255,.70);">Log in (local only)</span>
      </div>
      <button class="iconbtn" id="btnCloseAuth" aria-label="Close auth" title="Close">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div style="padding:12px;display:flex;flex-direction:column;gap:12px;">
      <div class="seg" role="group" aria-label="Auth mode">
        <button id="authTabLogin" class="active">Log in</button>
        <button id="authTabCreate">Create</button>
      </div>

      <input class="select" id="authEmail" placeholder="Email" inputmode="email" autocomplete="email"/>
      <input class="select" id="authPass" placeholder="Password" type="password" autocomplete="current-password"/>

      <button class="btn primary" id="btnAuthSubmit">Log in</button>

      <div class="hint">
        This is a temporary UI. It stores a “session” locally only.
        Later you’ll replace it with real graphics + a real backend.
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast" aria-live="polite" aria-atomic="true">
    <div class="toastInner">
      <div id="toastMsg">Ready.</div>
      <button class="iconbtn" id="toastClose" aria-label="Dismiss">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading" id="loading">
    <div class="loadingCard">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
        <div style="display:flex;flex-direction:column;gap:2px;">
          <strong style="font-size:15px;">ATHENS NAV</strong>
          <small style="color:rgba(234,240,255,.70);font-size:12px;" id="loadText">Loading map + widgets…</small>
        </div>
        <span style="font-size:12px;color:rgba(234,240,255,.68);">v1.3</span>
      </div>
      <div class="bar"><div id="loadBar"></div></div>
      <div style="font-size:12px;color:rgba(234,240,255,.70);line-height:1.35;">
        Athens-only • Tap to pin • Near Me opens on demand • Home routing controls
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
<script src="app.js"></script>
</body>
</html>
